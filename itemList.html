<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>全部楼盘</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="static/dist/light7/css/light7.min.css">
    <link rel="stylesheet" href="static/dist/light7/css/light7-swiper.min.css">
    <link rel="stylesheet" href="static/style/itemList.css">
</head>
<body>
<!-- page 容器 -->
<div class="page">
    <header class="bar bar-nav">
        <a class="button button-link button-nav pull-left back">
            <img src="static/img/icon_left@3x.png" alt="">
        </a>
        <h1 class="title">全部楼盘</h1>
    </header>
    <div class="bar bar-header-secondary J_search">
        <div class="searchbar">
            <a class="searchbar-cancel">搜索</a>
            <div class="search-input">
                <label for="search"><img src="static/img/icon_search.png"/></label>
                <input type="text" id='search' placeholder='项目名称' name="propertyName"/>
            </div>
        </div>
    </div>
    <div class="content infinite-scroll" data-distance="100">
        <div class="il_filter">
            <div class="il_filter_box">
                <div class="il_filter_item">
                    <span class="il_filter_item_txt">类型</span><span class="icon_down"></span>
                </div>
                <div class="il_filter_item">
                    <span class="il_filter_item_txt">总价</span><span class="icon_down"></span>
                </div>
                <div class="il_filter_item">
                    <span class="il_filter_item_txt">区域</span><span class="icon_down"></span>
                </div>
                <div class="il_filter_item">
                    <span class="il_filter_item_txt">售卖</span><span class="icon_down"></span>
                </div>
            </div>
            <div class="check_box_ul">
                <div class="value_label_box">
                    <input type="radio" name="houseType" value="" id="type_item0">
                    <label class="value_label" for="type_item0">
                        <div class="value_title">类型</div>
                        <div class="value_img"><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label>
                </div>
                <div class="value_label_box">
                    <input type="radio" name="houseType" value="2" id="type_item1">
                    <label class="value_label" for="type_item1">
                        <div class="value_title">别墅</div>
                        <div class="value_img"><img src="static/img/icon_check@3x.png"></div>
                    </label>
                </div>
                <div class="value_label_box">
                    <input type="radio" name="houseType" value="1" id="type_item2">
                    <label class="value_label" for="type_item2">
                        <div class="value_title">住宅</div>
                        <div class="value_img"><img src="static/img/icon_check@3x.png"></div>
                    </label>
                </div>
                <div class="value_label_box">
                    <input type="radio" name="houseType" value="4" id="type_item3">
                    <label class="value_label" for="type_item3">
                        <div class="value_title">商铺</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png"></div>
                    </label>
                </div>
                <div class="value_label_box">
                    <input type="radio" name="houseType" value="5" id="type_item4">
                    <label class="value_label" for="type_item4">
                        <div class="value_title">写字楼</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png"></div>
                    </label>
                </div>
                <div class="value_label_box">
                    <input type="radio" name="houseType" value="3" id="type_item5">
                    <label class="value_label" for="type_item5">
                        <div class="value_title">公寓</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png"></div>
                    </label>
                </div>
                <div class="value_label_box">
                    <input type="radio" name="houseType" value="6" id="type_item6">
                    <label class="value_label" for="type_item6">
                        <div class="value_title">洋房</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png"></div>
                    </label>
                </div>
            </div>
            <div class="check_box_ul">
                <div class="value_label_box"><input type="radio" name="salePriceLevel" value="" id="price_item1">
                    <label class="value_label" for="price_item1">
                        <div class="value_title">总价</div>
                        <div class="value_img"><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="salePriceLevel" value="0" id="price_item2">
                    <label class="value_label" for="price_item2">
                        <div class="value_title">0-50万</div>
                        <div class="value_img"><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="salePriceLevel" value="1" id="price_item3">
                    <label class="value_label" for="price_item3">
                        <div class="value_title">50-100万</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="salePriceLevel" value="2" id="price_item4">
                    <label class="value_label" for="price_item4">
                        <div class="value_title">100-150万</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="salePriceLevel" value="3" id="price_item5">
                    <label class="value_label" for="price_item5">
                        <div class="value_title">150-200万</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="salePriceLevel" value="4" id="price_item6">
                    <label class="value_label" for="price_item6">
                        <div class="value_title">200-250万</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="salePriceLevel" value="5" id="price_item8">
                    <label class="value_label" for="price_item8">
                        <div class="value_title">250-350万</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="salePriceLevel" value="6" id="price_item9">
                    <label class="value_label" for="price_item9">
                        <div class="value_title">350-400万</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="salePriceLevel" value="7" id="price_item10">
                    <label class="value_label" for="price_item10">
                        <div class="value_title">400-450万</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="salePriceLevel" value="8" id="price_item11">
                    <label class="value_label" for="price_item11">
                        <div class="value_title">450-500</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="salePriceLevel" value="9" id="price_item12">
                    <label class="value_label" for="price_item12">
                        <div class="value_title">>500万</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
            </div>
            <div class="check_box_ul" id="getCityList"></div>
            <div class="check_box_ul">
                <div class="value_label_box"> <input type="radio" name="sellState" value="" id="sale_item0">
                    <label class="value_label" for="sale_item0">
                        <div class="value_title">售卖</div>
                        <div class="value_img"><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="sellState" value="2" id="sale_item1">
                    <label class="value_label" for="sale_item1">
                        <div class="value_title">在售</div>
                        <div class="value_img"><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="sellState" value="1" id="sale_item2">
                    <label class="value_label" for="sale_item2">
                        <div class="value_title">预售</div>
                        <div class="value_img"><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"> <input type="radio" name="sellState" value="3" id="sale_item3">
                    <label class="value_label" for="sale_item3">
                        <div class="value_title">现房</div>
                        <div class="value_img"><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
                <div class="value_label_box"><input type="radio" name="sellState" value="4" id="sale_item4">
                    <label class="value_label" for="sale_item4">
                        <div class="value_title">售罄</div>
                        <div class="value_img "><img src="static/img/icon_check@3x.png" alt=""></div>
                    </label></div>
            </div>
            <div class="filter_mask"></div>
        </div>
        <div class="list-block media-list il_list">
            <ul id="getPropertyList"></ul>
        </div>
        <div class="infinite-scroll-preloader">
            <div class="preloader"></div>
        </div>
    </div>
</div>
<script type='text/javascript' src="static/dist/jquery-3.2.1.min.js" charset='utf-8'></script>
<script type='text/javascript' src='static/dist/light7/js/light7.min.js' charset='utf-8'></script>
<script src="static/usage.js"></script>
<script>
    $(function () {
        //*************************getCityList************************
        $ajax("indexPag/getCityList", {}, getCityList);

        function getCityList(data) {
            if (data.status === "success") {
                var dataStr = [];
                var dataStr1 = `<div class="value_label_box">
                                <input type="radio" name="cityID" value="" id="area_default">
                                <label class="value_label" for="area_default">
                                <div class="value_title">区域</div>
                                <div class="value_img"><img src="static/img/icon_check@3x.png" alt=""></div></label></div>`;
                dataStr.push(dataStr1);
                for (var i = 0, l = data.data.length; i < l; i++) {
                    var _dataStr = `<div class="value_label_box"><input type="radio" name="cityID" value="${data.data[i].cityID}" id="area_${data.data[i].cityID}">
                                <label class="value_label" for="area_${data.data[i].cityID}">
                                <div class="value_title">${data.data[i].cityName}</div>
                                <div class="value_img"><img src="static/img/icon_check@3x.png" alt=""></div></label></div>`;
                    dataStr.push(_dataStr)
                }
                dataStr = dataStr.join("");
                $("#getCityList").html(dataStr);
                //避免Ajax加载时间过长导致cityID没有radio选中效果
                // *************************ui***********************************
                //下拉选框
                var checkBoxUl = $(".il_filter .check_box_ul");
                $.each(checkBoxUl, function (index, ele) {
                    $(ele).find("input[type=radio]").eq(0).prop("checked", true);
                });
                //存储this[il_filter_item]占位
                var _radio;
                $(".il_filter_item").on("click", function () {
                    _radio = $(this);
                    checkBoxUl.hide();
                    _radio.find(".icon_down").removeClass("inactive").end().siblings().find(".icon_down").addClass("inactive");
                    checkBoxUl.eq(_radio.index()).show();
                    $(".filter_mask").show();
                });
                checkBoxUl.on("click", ".value_label_box", function () {
                    _radio.find(".il_filter_item_txt").html($(this).find(".value_title").html());
                    $(".il_filter_item .icon_down").removeClass("inactive");
                    $(".filter_mask").hide();
                    checkBoxUl.hide();
                });
                $(".filter_mask").on("click", function () {
                    $(".filter_mask").hide();
                    checkBoxUl.hide();
                });
                // *************************ui***********************************
            }
        }

        //*************************getCityList************************
        //*************************项目列表*************************
        var firstIndex = 1, loading = false, pageSize = 10;

        function getPropertyListInit() {
            $ajax("indexPag/getPropertyList", {
                agencyID: GetUrlParms().agencyID,
                sellState: $("input[name=sellState]:checked").val(),
                cityID: $("input[name=cityID]:checked").val(),
                salePriceLevel: $("input[name=salePriceLevel]:checked").val(),
                houseType: $("input[name=houseType]:checked").val(),
                propertyName: $("input[name=propertyName]").val(),
                firstIndex: firstIndex.toString(),
                pageSize: pageSize.toString()
            }, getPropertyList);
        }

        // 初始化加载列表
        getPropertyListInit();

        function getPropertyList(data) {
            if (data.status === "success") {
                loading = false;
                var dataStr = [], pageData = data.data.page;
                for (var i = 0, l = pageData.length; i < l; i++) {
                    var sellState = myCase(pageData[i].sellState);
                    var _dataStr = `<li>
                    <a class="item-content" href="pro.html?propertyID=${pageData[i].id}" external>
                        <div class="item-media">
                            <img src="${pageData[i].mainPic}?imageView2/2/h/100">
                            <div class="state">
                                ${pageData[i].lookSet === 0 ? "" : "<img src='static/img/icon_lable_dk@3x.png' />"}
                                ${pageData[i].dealSet === 0 ? "" : "<img src='static/img/icon_lable_cj@3x.png' />"}
                            </div>
                        </div>
                        <div class="item-inner">
                            <div class="item-title-row">
                                <div class="item-title">${pageData[i].propertyName}
                                <span class="state1">${sellState}</span>
                                ${pageData[i].qianYue === 0 ? "" : "<span class=\"state2\">签约项目</span>"}
                            </div>
                            </div>
                            <div class="item-subtitle">
                                <p class="p1"><span>${pageData[i].cityName}${pageData[i].boroughName}</span>${pageData[i].averagePrice}元/㎡</p>
                                <p class="p2">住宅<em></em><span>${pageData[i].minAcreage}-${pageData[i].maxAcreage}㎡</span></p>
                                <p class="p3"><span>佣</span>${pageData[i].commissionMoney}万元/套</p>
                            </div>
                        </div>
                    </a>
                </li>`;
                    dataStr.push(_dataStr)
                }
                dataStr = dataStr.join("");
                // 首页数据和非首页数据
                firstIndex === 1 ? $("#getPropertyList").html(dataStr) : $("#getPropertyList").append(dataStr);
                //首页数据数量过少情况
                if (firstIndex === 1 && pageData.length < pageSize) {
                    $(".infinite-scroll-preloader").hide();
                    $("#getPropertyList").append("<div class=\"il_footer\">共" + $("#getPropertyList > li").length + "个项目</div>");
                    loading = true;
                }
            } else if (data.status === "no_data") {
                // 没有数据了不再下拉加载
                loading = true;
                $(".infinite-scroll-preloader").hide();
                if (firstIndex === 1) {
                    $("#getPropertyList").html("<div class=\"il_footer\">没有相关数据</div>");
                    return
                }
                $("#getPropertyList").append("<div class=\"il_footer\">共" + $("#getPropertyList > li").length + "个项目</div>");
            } else {
                $.toast(data.info)
            }
        }

        // 用户修改筛选条件
        $(".il_filter").on("click", ".value_label_box input", function () {
            console.log("ok");
            firstIndex = 1;
            loading = false;
            $(".infinite-scroll-preloader").show();
            getPropertyListInit();
        });
        $(".searchbar-cancel").on("click", function () {
            firstIndex = 1;
            loading = false;
            $(".infinite-scroll-preloader").show();
            getPropertyListInit();
        });
        //下拉加载
        $(document).on('infinite', '.infinite-scroll', function () {
            // 如果正在加载，则退出
            if (loading) return;
            // 设置flag
            loading = true;
            firstIndex++;
            getPropertyListInit();
        });
        //*************************项目列表*************************
        //下拉加载初始化
        $.init()
    })
</script>
</body>
</html>